<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Day 20 Lab - Access Control & Segmentation (Windows Firewall)</title>
  <link rel="stylesheet" href="../assets/lab.css?v=1" />
</head>
<body>
  <div class="lab-container">
    <h1>Day 20 Lab</h1>
    <h2>Access Control & Segmentation (Windows Firewall)</h2>

    <p><strong>Objective:</strong> Simulate network ACLs on a Windows host: block by <em>port</em>, restrict by <em>remote IP</em> (micro-segmentation), verify with `Test-NetConnection`, and capture evidence via firewall logs. Finish with a cleanup step.</p>

    <h3>üõ† Tools Needed</h3>
    <ul>
      <li>Windows 10/11 PC with local admin rights</li>
      <li>Windows Defender Firewall (built-in)</li>
      <li>PowerShell (for quick tests)</li>
      <li>Internet access</li>
    </ul>

    <h3>‚ö†Ô∏è Safety First</h3>
    <p>These rules affect only your PC. Don‚Äôt create ‚Äúblock all‚Äù rules. We‚Äôll remove everything in the cleanup step.</p>

    <h3>Step 1 ‚Äî Create a Port-Based Block (Telnet / TCP 23)</h3>
    <p><em>GUI path:</em> Open <strong>Windows Defender Firewall with Advanced Security</strong> ‚Üí <strong>Outbound Rules</strong> ‚Üí <strong>New Rule‚Ä¶</strong> ‚Üí <strong>Port</strong> ‚Üí <strong>TCP</strong> port <code>23</code> ‚Üí <strong>Block the connection</strong> ‚Üí apply to all profiles ‚Üí name it <code>HL Block Telnet Out</code>.</p>
    <p><em>PowerShell (optional, one-liner):</em></p>
<pre><code>New-NetFirewallRule -DisplayName "HL Block Telnet Out" -Direction Outbound -Action Block -Protocol TCP -RemotePort 23 -Profile Any
</code></pre>

    <h3>Step 2 ‚Äî Verify the Rule</h3>
    <ul>
      <li>Test a Telnet socket (no client install needed):<br>
      <code>Test-NetConnection towel.blinkenlights.nl -Port 23</code><br>
      <em>Expected:</em> <code>TcpTestSucceeded : False</code> (blocked).</li>
      <li>Control test that should still work:<br>
      <code>Test-NetConnection 8.8.8.8 -Port 53</code> (DNS over UDP/TCP) or<br>
      <code>Test-NetConnection www.microsoft.com -Port 443</code> (HTTPS).</li>
    </ul>
    <div class="note">You just implemented a classic ACL: ‚Äúdeny tcp/23, permit the rest.‚Äù</div>

    <h3>Step 3 ‚Äî Micro-Segmentation by Remote IP</h3>
    <p>Create a rule that blocks traffic to a specific remote host/subnet while leaving others alone.</p>
    <p><em>GUI:</em> New <strong>Outbound</strong> ‚Üí <strong>Custom</strong> ‚Üí <em>Any program</em> ‚Üí <em>Any protocol</em> ‚Üí <strong>Which remote IP addresses?</strong> ‚Üí <em>These IP addresses</em> ‚Üí add <code>1.1.1.1</code> (Cloudflare) ‚Üí <strong>Block</strong> ‚Üí all profiles ‚Üí name <code>HL Block 1.1.1.1</code>.</p>
    <p><em>PowerShell (optional):</em></p>
<pre><code>New-NetFirewallRule -DisplayName "HL Block 1.1.1.1" -Direction Outbound -Action Block -RemoteAddress 1.1.1.1 -Profile Any
</code></pre>
    <p><em>Test:</em></p>
<pre><code>Test-NetConnection 1.1.1.1 -Port 443     # should fail
Test-NetConnection 8.8.8.8 -Port 443     # should succeed
</code></pre>
    <div class="note">This demonstrates host-level segmentation/allowlisting: one destination is isolated without touching everything else.</div>

    <h3>Step 4 ‚Äî Enable Logging & Capture Evidence</h3>
    <p>Turn on firewall logging and then re-run a blocked test to generate entries.</p>
<pre><code># Enable logging of allowed and dropped connections (per profile)
Set-NetFirewallProfile -Profile Domain,Public,Private -LogAllowed True -LogDropped True `
  -LogFileName "$env:windir\System32\LogFiles\Firewall\pfirewall.log" -LogMaxSizeKilobytes 16384

# Tail the last 50 lines after a failed connection attempt
Get-Content "$env:windir\System32\LogFiles\Firewall\pfirewall.log" -Tail 50
</code></pre>
    <p><em>Deliverable idea:</em> copy a few relevant log lines showing the block with timestamps.</p>

    <h3>Step 5 ‚Äî (Optional) Inbound Ping Control</h3>
    <p>If you have another device to ping you, try blocking ICMP Echo <em>inbound</em> on the <strong>Public</strong> profile:</p>
<pre><code>New-NetFirewallRule -DisplayName "HL Block ICMP In (Public)" -Direction Inbound `
  -Action Block -Protocol ICMPv4 -IcmpType 8 -Profile Public
</code></pre>
    <p>Connect your PC to a ‚ÄúPublic‚Äù network (or set the adapter to Public temporarily), then have a second device ping your IP. It should fail while other traffic (e.g., web) still works.</p>

    <h3>Step 6 ‚Äî Clean Up</h3>
<pre><code>Remove-NetFirewallRule -DisplayName "HL Block Telnet Out"
Remove-NetFirewallRule -DisplayName "HL Block 1.1.1.1"
# Optional, if you created it:
Remove-NetFirewallRule -DisplayName "HL Block ICMP In (Public)"
</code></pre>

    <h3>‚úÖ Deliverables</h3>
    <ul>
      <li>Screenshot of your two rules in <em>Outbound Rules</em> (names visible).</li>
      <li>PowerShell output showing <code>Test-NetConnection ... -Port 23</code> failing and HTTPS succeeding.</li>
      <li>Log snippet from <code>pfirewall.log</code> that captures a blocked attempt.</li>
      <li>(Optional) Evidence of inbound ICMP block from another device.</li>
    </ul>

    <h3>üéØ Stretch Goals</h3>
    <ul>
      <li>Create an <em>allow</em> rule that permits HTTPS only to <code>8.8.8.8/32</code> and confirm other HTTPS destinations fail.</li>
      <li>Convert the GUI rules to PowerShell and export them:
        <br><code>Get-NetFirewallRule | ? DisplayName -like "HL *" | Export-Clixml "$env:USERPROFILE\Desktop\hl-rules.xml"</code>
      </li>
      <li>Discuss how host-based rules complement network ACLs/VLANs (‚Äúdefense in depth‚Äù).</li>
    </ul>

    <h3>üß† Reflect</h3>
    <ol>
      <li>In what ways do these host rules behave like router/firewall ACLs?</li>
      <li>How does blocking by remote IP simulate segmentation or zero-trust principles?</li>
      <li>When might logging be more valuable than blocking?</li>
    </ol>

    <hr />
    <p><strong>Lab Summary:</strong> You enforced port and destination controls with Windows Firewall, validated behavior with socket tests, and recorded proof via logs‚Äîmirroring how ACLs and segmentation are applied in real environments.</p>
  </div>
</body>
</html>
